<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estudo+ FÃ¡cil - Seu Planner Escolar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCsIDy5vZfKn0-mqb24XIP0s43C5M_KkUM",
            authDomain: "estudomais-da927.firebaseapp.com",
            projectId: "estudomais-da927",
            storageBucket: "estudomais-da927.firebasestorage.app",
            messagingSenderId: "461170190310",
            appId: "1:461170190310:web:d727cbbedce3397e3a1827",
            measurementId: "G-RL599YX1DL"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const analytics = getAnalytics(app);

        // Make Firebase available globally
        window.firebaseApp = app;
        window.firebaseDb = db;
        window.firebaseAuth = auth;
        window.firebaseAnalytics = analytics;
        
        // Firebase functions
        window.firebaseFunctions = {
            addDoc,
            getDocs,
            updateDoc,
            deleteDoc,
            doc,
            collection,
            onSnapshot,
            query,
            orderBy,
            limit,
            signInAnonymously,
            onAuthStateChanged
        };

        // Make auth functions available globally
        window.firebaseAuthFunctions = {
            signInAnonymously,
            onAuthStateChanged,
            signOut: () => auth.signOut()
        };

        // Don't auto-login, wait for user action
        console.log('ğŸ”¥ Firebase inicializado, aguardando login...');
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .tech-font {
            font-family: 'JetBrains Mono', monospace;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .tech-gradient {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5), 0 0 40px rgba(102, 126, 234, 0.3);
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .subject-math { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .subject-portuguese { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .subject-science { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .subject-history { background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); }
        .subject-english { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }
        .subject-pe { background: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%); }
        
        .priority-high { border-left: 4px solid #ef4444; }
        .priority-medium { border-left: 4px solid #f59e0b; }
        .priority-low { border-left: 4px solid #10b981; }
        
        .achievement-badge {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .mood-emoji {
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .mood-emoji:hover {
            transform: scale(1.2);
        }
        
        .notification {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Tech Opening Animations */
        .tech-opening {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .matrix-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .matrix-char {
            position: absolute;
            color: #00ff41;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            animation: matrix-fall linear infinite;
            opacity: 0.7;
        }
        
        @keyframes matrix-fall {
            0% { transform: translateY(-100vh); opacity: 1; }
            100% { transform: translateY(100vh); opacity: 0; }
        }
        
        .glitch {
            animation: glitch 2s infinite;
        }
        
        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            10% { transform: translate(-2px, 2px); }
            20% { transform: translate(2px, -2px); }
            30% { transform: translate(-2px, -2px); }
            40% { transform: translate(2px, 2px); }
            50% { transform: translate(-2px, 2px); }
            60% { transform: translate(2px, -2px); }
            70% { transform: translate(-2px, -2px); }
            80% { transform: translate(2px, 2px); }
            90% { transform: translate(-2px, 2px); }
        }
        
        .typing-animation {
            overflow: hidden;
            border-right: 3px solid #00ff41;
            white-space: nowrap;
            animation: typing 3s steps(40, end), blink-caret 0.75s step-end infinite;
        }
        
        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: #00ff41; }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes pulse-glow {
            from { box-shadow: 0 0 20px rgba(0, 255, 65, 0.5); }
            to { box-shadow: 0 0 40px rgba(0, 255, 65, 0.8), 0 0 60px rgba(0, 255, 65, 0.6); }
        }
        
        .circuit-line {
            position: absolute;
            background: linear-gradient(90deg, transparent, #00ff41, transparent);
            height: 2px;
            animation: circuit-flow 3s linear infinite;
        }
        
        @keyframes circuit-flow {
            0% { width: 0%; opacity: 0; }
            50% { opacity: 1; }
            100% { width: 100%; opacity: 0; }
        }
        
        .fade-out {
            animation: fadeOut 1s ease-out forwards;
        }
        
        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }
        
        .slide-up {
            animation: slideUp 0.8s ease-out forwards;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .scale-in {
            animation: scaleIn 0.6s ease-out forwards;
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Screen -->
    <div id="login-screen" class="tech-opening tech-gradient">
        <!-- Matrix Background -->
        <div class="matrix-bg" id="login-matrix-bg"></div>
        
        <!-- Circuit Lines -->
        <div class="circuit-line" style="top: 20%; left: 0; animation-delay: 0s;"></div>
        <div class="circuit-line" style="top: 40%; right: 0; animation-delay: 1s;"></div>
        <div class="circuit-line" style="top: 60%; left: 0; animation-delay: 2s;"></div>
        <div class="circuit-line" style="top: 80%; right: 0; animation-delay: 3s;"></div>
        
        <!-- Login Content -->
        <div class="relative z-10 text-center max-w-md mx-auto px-6">
            <!-- Logo -->
            <div class="mb-8">
                <div class="inline-block p-6 rounded-full bg-gradient-to-r from-cyan-400 to-blue-500 neon-glow pulse-glow">
                    <div class="text-6xl">ğŸ“</div>
                </div>
            </div>
            
            <!-- Title -->
            <div class="mb-8">
                <h1 class="text-4xl md:text-5xl font-bold text-white glitch mb-4">
                    <span class="bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent">
                        Estudo+ FÃ¡cil
                    </span>
                </h1>
                <div class="text-lg text-cyan-300 tech-font">
                    FaÃ§a login para continuar
                </div>
            </div>
            
            <!-- Login Form -->
            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 border border-cyan-500/30 mb-6">
                <form onsubmit="handleLogin(event)" class="space-y-4">
                    <div>
                        <label class="block text-cyan-200 text-sm font-medium mb-2">Nome de UsuÃ¡rio</label>
                        <input type="text" id="username" required 
                               class="w-full p-3 bg-white/20 border border-cyan-500/50 rounded-lg text-white placeholder-cyan-300 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/50 focus:outline-none"
                               placeholder="Digite seu nome">
                    </div>
                    
                    <div>
                        <label class="block text-cyan-200 text-sm font-medium mb-2">Senha</label>
                        <input type="password" id="password" required 
                               class="w-full p-3 bg-white/20 border border-cyan-500/50 rounded-lg text-white placeholder-cyan-300 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/50 focus:outline-none"
                               placeholder="Digite sua senha">
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-semibold py-3 rounded-lg hover:from-cyan-400 hover:to-blue-500 transition-all duration-300 transform hover:scale-105 neon-glow">
                        ğŸš€ Entrar
                    </button>
                </form>
                
                <div class="mt-4 text-center">
                    <div class="text-cyan-300 text-sm mb-2">ou</div>
                    <button onclick="loginAsGuest()" 
                            class="text-cyan-400 hover:text-cyan-300 text-sm underline">
                        ğŸ¯ Entrar como Visitante
                    </button>
                </div>
            </div>
            
            <!-- Quick Login Options -->
            <div class="space-y-2 mb-6">
                <div class="text-cyan-300 text-sm mb-3">Login RÃ¡pido:</div>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="quickLogin('Ana Silva')" 
                            class="bg-white/10 hover:bg-white/20 text-cyan-200 py-2 px-3 rounded-lg text-sm transition-colors">
                        ğŸ‘©â€ğŸ“ Ana Silva
                    </button>
                    <button onclick="quickLogin('Bruno Costa')" 
                            class="bg-white/10 hover:bg-white/20 text-cyan-200 py-2 px-3 rounded-lg text-sm transition-colors">
                        ğŸ‘¨â€ğŸ“ Bruno Costa
                    </button>
                    <button onclick="quickLogin('Carla Lima')" 
                            class="bg-white/10 hover:bg-white/20 text-cyan-200 py-2 px-3 rounded-lg text-sm transition-colors">
                        ğŸ‘©â€ğŸ“ Carla Lima
                    </button>
                    <button onclick="quickLogin('Diego Santos')" 
                            class="bg-white/10 hover:bg-white/20 text-cyan-200 py-2 px-3 rounded-lg text-sm transition-colors">
                        ğŸ‘¨â€ğŸ“ Diego Santos
                    </button>
                </div>
            </div>
            
            <!-- Info -->
            <div class="text-xs text-cyan-400 opacity-75">
                ğŸ’¡ Use qualquer nome e senha para entrar<br>
                ou clique em "Entrar como Visitante"
            </div>
        </div>
    </div>

    <!-- Tech Opening Screen -->
    <div id="tech-opening" class="tech-opening tech-gradient hidden">
        <!-- Matrix Background -->
        <div class="matrix-bg" id="matrix-bg"></div>
        
        <!-- Circuit Lines -->
        <div class="circuit-line" style="top: 20%; left: 0; animation-delay: 0s;"></div>
        <div class="circuit-line" style="top: 40%; right: 0; animation-delay: 1s;"></div>
        <div class="circuit-line" style="top: 60%; left: 0; animation-delay: 2s;"></div>
        <div class="circuit-line" style="top: 80%; right: 0; animation-delay: 3s;"></div>
        
        <!-- Main Content -->
        <div class="relative z-10 text-center max-w-4xl mx-auto px-6">
            <!-- Logo/Icon -->
            <div class="mb-8">
                <div class="inline-block p-6 rounded-full bg-gradient-to-r from-cyan-400 to-blue-500 neon-glow pulse-glow">
                    <div class="text-6xl">ğŸš€</div>
                </div>
            </div>
            
            <!-- App Title -->
            <div class="mb-6">
                <h1 class="text-6xl md:text-8xl font-bold text-white glitch mb-4">
                    <span class="bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent">
                        Estudo+
                    </span>
                </h1>
                <div class="text-2xl md:text-3xl font-light text-cyan-300 tech-font typing-animation">
                    Seu Planner Escolar Inteligente
                </div>
            </div>
            
            <!-- Features Preview -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 opacity-0" id="features-grid">
                <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-cyan-500/30">
                    <div class="text-2xl mb-2">ğŸ“…</div>
                    <div class="text-sm text-cyan-200">Agenda</div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-purple-500/30">
                    <div class="text-2xl mb-2">âœ…</div>
                    <div class="text-sm text-purple-200">Tarefas</div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-green-500/30">
                    <div class="text-2xl mb-2">ğŸ“Š</div>
                    <div class="text-sm text-green-200">Progresso</div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-yellow-500/30">
                    <div class="text-2xl mb-2">ğŸ’¬</div>
                    <div class="text-sm text-yellow-200">Chat</div>
                </div>
            </div>
            
            <!-- Loading Bar -->
            <div class="mb-8 opacity-0" id="loading-section">
                <div class="text-cyan-300 mb-4 tech-font">Inicializando sistema...</div>
                <div class="w-full bg-gray-700 rounded-full h-2 overflow-hidden">
                    <div id="loading-bar" class="h-full bg-gradient-to-r from-cyan-400 to-blue-500 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div id="loading-text" class="text-sm text-gray-400 mt-2 tech-font">Carregando mÃ³dulos...</div>
            </div>
            
            <!-- Enter Button -->
            <div class="opacity-0" id="enter-section">
                <button onclick="enterApp()" class="group relative px-8 py-4 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-full text-white font-semibold text-lg hover:from-cyan-400 hover:to-blue-500 transition-all duration-300 transform hover:scale-105 neon-glow">
                    <span class="relative z-10">ğŸ¯ Entrar no Sistema</span>
                    <div class="absolute inset-0 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                </button>
            </div>
            
            <!-- Developer Info -->
            <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 text-center opacity-0" id="developer-info">
                <div class="bg-black/30 backdrop-blur-sm rounded-lg p-4 border border-cyan-500/20">
                    <div class="text-cyan-300 font-semibold tech-font">Desenvolvido por</div>
                    <div class="text-white text-lg font-bold">Matheus Ivan Rodrigues</div>
                    <div class="text-gray-400 text-sm tech-font">@2025 â€¢ Tecnologia Educacional</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Content (Hidden Initially) -->
    <div id="main-app" class="hidden">
        <!-- Header -->
        <header class="gradient-bg text-white p-6 card-shadow">
            <div class="max-w-6xl mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="text-3xl">ğŸ“š</div>
                    <h1 class="text-2xl font-bold">Estudo+ FÃ¡cil</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="firebase-status" class="text-xs bg-white/20 px-2 py-1 rounded-full">
                        ğŸ”„ Conectando...
                    </div>
                    <div class="text-sm">OlÃ¡, <span id="studentName">Estudante</span>! ğŸ˜Š</div>
                    <button onclick="showAchievements()" class="bg-white/20 px-4 py-2 rounded-full text-sm hover:bg-white/30 transition-colors">
                        ğŸ† Conquistas
                    </button>
                    <button onclick="logout()" class="bg-red-500/20 px-4 py-2 rounded-full text-sm hover:bg-red-500/30 transition-colors">
                        ğŸšª Sair
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-6xl mx-auto px-6">
                <div class="flex space-x-8">
                    <button onclick="showSection('schedule')" class="nav-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium">
                        ğŸ“… Agenda
                    </button>
                    <button onclick="showSection('tasks')" class="nav-btn py-4 px-2 text-gray-500 hover:text-blue-600">
                        âœ… Tarefas
                    </button>
                    <button onclick="showSection('calendar')" class="nav-btn py-4 px-2 text-gray-500 hover:text-blue-600">
                        ğŸ“† CalendÃ¡rio
                    </button>
                    <button onclick="showSection('diary')" class="nav-btn py-4 px-2 text-gray-500 hover:text-blue-600">
                        ğŸ“– DiÃ¡rio
                    </button>
                    <button onclick="showSection('progress')" class="nav-btn py-4 px-2 text-gray-500 hover:text-blue-600">
                        ğŸ“Š Progresso
                    </button>
                    <button onclick="showSection('chat')" class="nav-btn py-4 px-2 text-gray-500 hover:text-blue-600">
                        ğŸ’¬ Chat
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-6xl mx-auto p-6">
            <!-- Schedule Section -->
            <div id="schedule-section" class="section">
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 space-y-4 lg:space-y-0">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ“… Agenda Escolar</h2>
                        <p class="text-gray-600">Organize suas aulas e horÃ¡rios da semana</p>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-lg p-4 card-shadow text-center">
                        <div class="text-2xl font-bold text-blue-600" id="total-classes">0</div>
                        <div class="text-sm text-gray-600">Aulas/Semana</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 card-shadow text-center">
                        <div class="text-2xl font-bold text-green-600" id="total-subjects">0</div>
                        <div class="text-sm text-gray-600">MatÃ©rias</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 card-shadow text-center">
                        <div class="text-2xl font-bold text-purple-600" id="busiest-day">-</div>
                        <div class="text-sm text-gray-600">Dia + Cheio</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 card-shadow text-center">
                        <div class="text-2xl font-bold text-orange-600" id="next-class">-</div>
                        <div class="text-sm text-gray-600">PrÃ³xima Aula</div>
                    </div>
                </div>

                <!-- Current Day Highlight -->
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold">ğŸ“š Hoje Ã© <span id="current-day-name"></span></h3>
                            <p class="text-blue-100">Suas aulas de hoje:</p>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold" id="today-classes-count">0</div>
                            <div class="text-sm text-blue-100">aulas</div>
                        </div>
                    </div>
                    <div id="today-schedule" class="mt-3 space-y-2">
                        <!-- Today's classes will be populated here -->
                    </div>
                </div>

                <!-- Schedule Grid -->
                <div class="bg-white rounded-lg card-shadow overflow-hidden">
                    <div class="p-4 bg-gray-50 border-b">
                        <h3 class="font-semibold text-gray-800">ğŸ“‹ Grade HorÃ¡ria Semanal</h3>
                    </div>
                    
                    <div id="schedule-container" class="overflow-x-auto">
                        <div class="grid grid-cols-8 gap-2 p-4 min-w-full" style="min-width: 800px;">
                            <div class="font-semibold text-center text-gray-600 py-3 bg-gray-100 rounded-lg">â° HorÃ¡rio</div>
                            <div class="font-semibold text-center text-gray-600 py-3 bg-blue-50 rounded-lg">ğŸŒ… Segunda</div>
                            <div class="font-semibold text-center text-gray-600 py-3 bg-green-50 rounded-lg">ğŸŒ¤ï¸ TerÃ§a</div>
                            <div class="font-semibold text-center text-gray-600 py-3 bg-yellow-50 rounded-lg">â˜€ï¸ Quarta</div>
                            <div class="font-semibold text-center text-gray-600 py-3 bg-orange-50 rounded-lg">ğŸŒ… Quinta</div>
                            <div class="font-semibold text-center text-gray-600 py-3 bg-red-50 rounded-lg">ğŸ‰ Sexta</div>
                            <div class="font-semibold text-center text-gray-600 py-3 bg-purple-50 rounded-lg">ğŸ–ï¸ SÃ¡bado</div>
                            <div class="font-semibold text-center text-gray-600 py-3 bg-pink-50 rounded-lg">ğŸ˜´ Domingo</div>
                        </div>
                        
                        <div id="schedule-grid" class="grid grid-cols-8 gap-2 p-4 min-w-full" style="min-width: 800px;">
                            <!-- Schedule will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks Section -->
            <div id="tasks-section" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">âœ… Lista de Tarefas</h2>
                    <button onclick="addTask()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                        â• Nova Tarefa
                    </button>
                </div>
                
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-white rounded-lg p-4 card-shadow">
                        <h3 class="font-semibold text-red-600 mb-3">ğŸ”´ Urgente</h3>
                        <div id="urgent-tasks" class="space-y-2"></div>
                    </div>
                    <div class="bg-white rounded-lg p-4 card-shadow">
                        <h3 class="font-semibold text-yellow-600 mb-3">ğŸŸ¡ MÃ©dio</h3>
                        <div id="medium-tasks" class="space-y-2"></div>
                    </div>
                    <div class="bg-white rounded-lg p-4 card-shadow">
                        <h3 class="font-semibold text-green-600 mb-3">ğŸŸ¢ Tranquilo</h3>
                        <div id="low-tasks" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <!-- Calendar Section -->
            <div id="calendar-section" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">ğŸ“† CalendÃ¡rio Mensal</h2>
                    <button onclick="addEvent()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                        â• Novo Evento
                    </button>
                </div>
                
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <div class="flex justify-between items-center mb-4">
                        <button onclick="previousMonth()" class="text-2xl hover:bg-gray-100 p-2 rounded">â†</button>
                        <h3 id="current-month" class="text-xl font-semibold"></h3>
                        <button onclick="nextMonth()" class="text-2xl hover:bg-gray-100 p-2 rounded">â†’</button>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-2"></div>
                </div>
            </div>

            <!-- Diary Section -->
            <div id="diary-section" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“– DiÃ¡rio de Estudos</h2>
                
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Como foi seu dia hoje?</label>
                        <div class="flex space-x-4 mb-4">
                            <span class="mood-emoji" onclick="setMood('happy')">ğŸ˜ƒ</span>
                            <span class="mood-emoji" onclick="setMood('neutral')">ğŸ˜</span>
                            <span class="mood-emoji" onclick="setMood('sad')">ğŸ˜</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">O que vocÃª aprendeu hoje?</label>
                        <textarea id="learning-notes" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="4" placeholder="Escreva sobre o que aprendeu hoje..."></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Dificuldades encontradas:</label>
                        <textarea id="difficulties" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Quais foram suas dificuldades?"></textarea>
                    </div>
                    
                    <button onclick="saveDiaryEntry()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        ğŸ’¾ Salvar Entrada
                    </button>
                </div>
                
                <div class="mt-6">
                    <h3 class="text-lg font-semibold mb-4">ğŸ“ Entradas Anteriores</h3>
                    <div id="diary-entries" class="space-y-4"></div>
                </div>
            </div>

            <!-- Progress Section -->
            <div id="progress-section" class="section hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“Š RelatÃ³rio de Progresso</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <h3 class="text-lg font-semibold mb-4">ğŸ“ˆ Notas por MatÃ©ria</h3>
                        <div id="grades-chart" class="space-y-4"></div>
                        <button onclick="addGrade()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            â• Adicionar Nota
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <h3 class="text-lg font-semibold mb-4">ğŸ† Conquistas</h3>
                        <div id="achievements-list" class="space-y-3"></div>
                    </div>
                </div>
            </div>

            <!-- Chat Section -->
            <div id="chat-section" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">ğŸ’¬ Chat dos Estudantes</h2>
                    <div class="flex space-x-2">
                        <button onclick="shareProgress()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            ğŸ“Š Compartilhar Progresso
                        </button>
                        <button onclick="shareDiary()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                            ğŸ“– Compartilhar DiÃ¡rio
                        </button>
                    </div>
                </div>
                
                <div class="grid lg:grid-cols-4 gap-6">
                    <!-- Online Users -->
                    <div class="bg-white rounded-lg p-4 card-shadow">
                        <h3 class="font-semibold text-gray-800 mb-4 flex items-center">
                            <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                            Online (4)
                        </h3>
                        <div id="online-users" class="space-y-2">
                            <div class="flex items-center space-x-2 p-2 hover:bg-gray-50 rounded">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-bold">A</div>
                                <div>
                                    <div class="font-medium text-sm">Ana Silva</div>
                                    <div class="text-xs text-gray-500">ğŸ“š Estudando</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 p-2 hover:bg-gray-50 rounded">
                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm font-bold">B</div>
                                <div>
                                    <div class="font-medium text-sm">Bruno Costa</div>
                                    <div class="text-xs text-gray-500">â° Pomodoro</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 p-2 hover:bg-gray-50 rounded">
                                <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold">C</div>
                                <div>
                                    <div class="font-medium text-sm">Carla Lima</div>
                                    <div class="text-xs text-gray-500">âœ… Fazendo tarefas</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 p-2 hover:bg-gray-50 rounded">
                                <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-white text-sm font-bold">D</div>
                                <div>
                                    <div class="font-medium text-sm">Diego Santos</div>
                                    <div class="text-xs text-gray-500">ğŸ“ Revisando</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Messages -->
                    <div class="lg:col-span-3 bg-white rounded-lg card-shadow flex flex-col h-96">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="font-semibold text-gray-800">ğŸ’¬ Conversa Geral</h3>
                            <div class="text-sm text-gray-500">Compartilhe seus estudos e motive seus colegas!</div>
                        </div>
                        
                        <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4">
                            <!-- Messages will be populated here -->
                        </div>
                        
                        <div class="p-4 border-t border-gray-200">
                            <div class="flex space-x-2">
                                <input type="text" id="chat-input" placeholder="Digite sua mensagem..." 
                                       class="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       onkeypress="handleChatKeyPress(event)">
                                <button onclick="sendMessage()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                                    ğŸ“¤
                                </button>
                            </div>
                            <div class="flex space-x-2 mt-2">
                                <button onclick="sendEmoji('ğŸ‘')" class="text-lg hover:bg-gray-100 p-1 rounded">ğŸ‘</button>
                                <button onclick="sendEmoji('â¤ï¸')" class="text-lg hover:bg-gray-100 p-1 rounded">â¤ï¸</button>
                                <button onclick="sendEmoji('ğŸ˜Š')" class="text-lg hover:bg-gray-100 p-1 rounded">ğŸ˜Š</button>
                                <button onclick="sendEmoji('ğŸ‰')" class="text-lg hover:bg-gray-100 p-1 rounded">ğŸ‰</button>
                                <button onclick="sendEmoji('ğŸ“š')" class="text-lg hover:bg-gray-100 p-1 rounded">ğŸ“š</button>
                                <button onclick="sendEmoji('ğŸ’ª')" class="text-lg hover:bg-gray-100 p-1 rounded">ğŸ’ª</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Shared Content Feed -->
                <div class="mt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“‹ Compartilhamentos Recentes</h3>
                    <div id="shared-content" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Shared content will be populated here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Area -->
    <div id="notifications" class="fixed top-20 right-4 space-y-2 z-50"></div>

    <!-- Modals -->
    <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50" onclick="closeModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div id="modal-content" class="bg-white rounded-lg p-6 max-w-md w-full" onclick="event.stopPropagation()">
                <!-- Modal content will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Initialize login screen
        document.addEventListener('DOMContentLoaded', function() {
            initLoginScreen();
        });

        function initLoginScreen() {
            // Create matrix effect for login screen
            createMatrixEffect('login-matrix-bg');
        }

        // Login functions
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (username && password) {
                authenticateUser(username);
            }
        }

        function quickLogin(username) {
            authenticateUser(username);
        }

        function loginAsGuest() {
            authenticateUser('Visitante');
        }

        function authenticateUser(username) {
            // Show loading state
            showLoginLoading();
            
            // Set current user
            currentUser = username;
            document.getElementById('studentName').textContent = username;
            
            // Authenticate with Firebase
            window.firebaseAuthFunctions.signInAnonymously(window.firebaseAuth).then(() => {
                console.log('ğŸ”¥ Firebase conectado com sucesso!');
                if (window.initFirebaseData) {
                    window.initFirebaseData();
                }
                
                // Proceed to tech opening after successful auth
                setTimeout(() => {
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('tech-opening').classList.remove('hidden');
                    initTechOpening();
                }, 1500);
                
            }).catch((error) => {
                console.error('Erro ao conectar com Firebase:', error);
                // Still proceed even if Firebase fails
                setTimeout(() => {
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('tech-opening').classList.remove('hidden');
                    initTechOpening();
                }, 1500);
            });
        }

        function showLoginLoading() {
            const loginScreen = document.getElementById('login-screen');
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'login-loading';
            loadingOverlay.className = 'absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-20';
            loadingOverlay.innerHTML = `
                <div class="text-center">
                    <div class="inline-block p-4 rounded-full bg-gradient-to-r from-cyan-400 to-blue-500 neon-glow pulse-glow mb-4">
                        <div class="text-3xl">ğŸ”„</div>
                    </div>
                    <div class="text-white font-semibold mb-2">Autenticando...</div>
                    <div class="text-cyan-300 text-sm tech-font">Conectando ao sistema</div>
                </div>
            `;
            loginScreen.appendChild(loadingOverlay);
        }

        function initTechOpening() {
            // Create matrix effect
            createMatrixEffect();
            
            // Animate elements in sequence
            setTimeout(() => {
                document.getElementById('features-grid').classList.add('scale-in');
                document.getElementById('features-grid').style.opacity = '1';
            }, 2000);
            
            setTimeout(() => {
                document.getElementById('loading-section').classList.add('slide-up');
                document.getElementById('loading-section').style.opacity = '1';
                startLoadingAnimation();
            }, 3000);
            
            setTimeout(() => {
                document.getElementById('developer-info').classList.add('slide-up');
                document.getElementById('developer-info').style.opacity = '1';
            }, 4000);
        }

        function createMatrixEffect(containerId = 'matrix-bg') {
            const matrixBg = document.getElementById(containerId);
            const chars = '01ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³ã‚µã‚·ã‚¹ã‚»ã‚½ã‚¿ãƒãƒ„ãƒ†ãƒˆãƒŠãƒ‹ãƒŒãƒãƒãƒãƒ’ãƒ•ãƒ˜ãƒ›ãƒãƒŸãƒ ãƒ¡ãƒ¢ãƒ¤ãƒ¦ãƒ¨ãƒ©ãƒªãƒ«ãƒ¬ãƒ­ãƒ¯ãƒ²ãƒ³';
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const char = document.createElement('div');
                    char.className = 'matrix-char';
                    char.textContent = chars[Math.floor(Math.random() * chars.length)];
                    char.style.left = Math.random() * 100 + '%';
                    char.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    char.style.animationDelay = Math.random() * 2 + 's';
                    matrixBg.appendChild(char);
                    
                    // Remove after animation
                    setTimeout(() => {
                        if (char.parentNode) {
                            char.parentNode.removeChild(char);
                        }
                    }, 5000);
                }, i * 100);
            }
        }

        function startLoadingAnimation() {
            const loadingBar = document.getElementById('loading-bar');
            const loadingText = document.getElementById('loading-text');
            
            const steps = [
                { width: 20, text: 'Carregando interface...' },
                { width: 40, text: 'Inicializando banco de dados...' },
                { width: 60, text: 'Configurando mÃ³dulos...' },
                { width: 80, text: 'Preparando sistema...' },
                { width: 100, text: 'Sistema pronto!' }
            ];
            
            let currentStep = 0;
            
            const interval = setInterval(() => {
                if (currentStep < steps.length) {
                    loadingBar.style.width = steps[currentStep].width + '%';
                    loadingText.textContent = steps[currentStep].text;
                    currentStep++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('enter-section').classList.add('scale-in');
                        document.getElementById('enter-section').style.opacity = '1';
                    }, 500);
                }
            }, 800);
        }

        function enterApp() {
            // Fade out opening screen
            document.getElementById('tech-opening').classList.add('fade-out');
            
            setTimeout(() => {
                document.getElementById('tech-opening').style.display = 'none';
                document.getElementById('main-app').classList.remove('hidden');
                
                // Initialize main app
                loadData();
                initializeSchedule();
                updateCalendar();
                updateTasksDisplay();
                updateProgressDisplay();
                showMotivationalMessage();
                initializeChat();
                
                // Show welcome notification
                setTimeout(() => {
                    showNotification('ğŸš€ Bem-vindo ao Estudo+ FÃ¡cil! Vamos organizar seus estudos!', 'success');
                }, 500);
            }, 1000);
        }

        // Logout function
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                // Sign out from Firebase
                if (window.firebaseAuthFunctions && window.firebaseAuth) {
                    window.firebaseAuthFunctions.signOut().then(() => {
                        console.log('ğŸšª Logout realizado com sucesso');
                    }).catch((error) => {
                        console.error('Erro no logout:', error);
                    });
                }
                
                // Reset user data
                currentUser = 'Estudante';
                currentUserId = null;
                isFirebaseReady = false;
                
                // Clear local data
                localStorage.removeItem('estudoFacilData');
                
                // Reset all data
                scheduleData = {};
                tasksData = { urgent: [], medium: [], low: [] };
                eventsData = [];
                diaryEntries = [];
                gradesData = {};
                achievements = [];
                chatMessages = [];
                sharedContent = [];
                
                // Hide main app and show login screen
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('tech-opening').style.display = 'none';
                document.getElementById('login-screen').style.display = 'flex';
                
                // Clear login form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                // Remove loading overlay if exists
                const loadingOverlay = document.getElementById('login-loading');
                if (loadingOverlay) {
                    loadingOverlay.remove();
                }
                
                // Recreate matrix effect
                initLoginScreen();
                
                showNotification('ğŸ‘‹ Logout realizado com sucesso!', 'success');
            }
        }

        // Global variables
        let currentDate = new Date();
        let timerInterval;
        let timerMinutes = 25;
        let timerSeconds = 0;
        let isTimerRunning = false;
        let pomodoroCount = 0;
        let currentMood = null;
        let currentUser = 'VocÃª';

        // Data storage
        let scheduleData = {};
        let tasksData = { urgent: [], medium: [], low: [] };
        let eventsData = [];
        let diaryEntries = [];
        let gradesData = {};
        let achievements = [];
        let chatMessages = [];
        let sharedContent = [];

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('text-gray-500');
            });
            
            event.target.classList.add('border-blue-500', 'text-blue-600');
            event.target.classList.remove('text-gray-500');
        }

        // Schedule functions
        let isCompactView = false;
        
        function initializeSchedule() {
            updateScheduleDisplay();
            updateScheduleStats();
            updateTodaySchedule();
            updateSubjectLegend();
            updateUpcomingClasses();
        }

        function updateScheduleDisplay() {
            const scheduleGrid = document.getElementById('schedule-grid');
            const timeSlots = ['07:00', '08:00', '09:00', '10:00', '11:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            scheduleGrid.innerHTML = '';
            
            timeSlots.forEach(time => {
                // Time column
                const timeCell = document.createElement('div');
                timeCell.className = 'text-center py-3 px-2 font-medium text-gray-600 bg-gray-50 rounded-lg border';
                timeCell.textContent = time;
                scheduleGrid.appendChild(timeCell);
                
                // Day columns
                days.forEach(day => {
                    const cell = document.createElement('div');
                    cell.className = 'min-h-16 border-2 border-dashed border-gray-200 rounded-lg p-2 hover:border-blue-300 transition-all cursor-pointer hover:shadow-md';
                    cell.onclick = () => addClassToSchedule(day, time);
                    
                    if (scheduleData[day] && scheduleData[day][time]) {
                        const classData = scheduleData[day][time];
                        cell.className = `min-h-16 rounded-lg p-2 text-white font-medium subject-${classData.subject} hover:shadow-lg transition-all cursor-pointer relative`;
                        cell.innerHTML = `
                            <div class="text-sm font-semibold">${classData.name}</div>
                            <div class="text-xs opacity-90">${classData.room}</div>
                            <div class="text-xs opacity-80">${classData.teacher || ''}</div>
                            <button onclick="editClass(event, '${day}', '${time}')" class="absolute top-1 right-1 text-white hover:text-gray-200 text-xs">âœï¸</button>
                            <button onclick="deleteClass(event, '${day}', '${time}')" class="absolute top-1 right-6 text-white hover:text-red-200 text-xs">ğŸ—‘ï¸</button>
                        `;
                    } else {
                        cell.innerHTML = `
                            <div class="text-center text-gray-400 text-xs">
                                <div>â•</div>
                                <div>Adicionar</div>
                            </div>
                        `;
                    }
                    
                    scheduleGrid.appendChild(cell);
                });
            });
        }

        function updateScheduleStats() {
            let totalClasses = 0;
            const subjects = new Set();
            const dayCount = { monday: 0, tuesday: 0, wednesday: 0, thursday: 0, friday: 0, saturday: 0, sunday: 0 };
            
            Object.keys(scheduleData).forEach(day => {
                Object.keys(scheduleData[day]).forEach(time => {
                    totalClasses++;
                    subjects.add(scheduleData[day][time].subject);
                    dayCount[day]++;
                });
            });
            
            document.getElementById('total-classes').textContent = totalClasses;
            document.getElementById('total-subjects').textContent = subjects.size;
            
            // Find busiest day
            const busiestDay = Object.keys(dayCount).reduce((a, b) => dayCount[a] > dayCount[b] ? a : b);
            const dayNames = {
                monday: 'Segunda', tuesday: 'TerÃ§a', wednesday: 'Quarta',
                thursday: 'Quinta', friday: 'Sexta', saturday: 'SÃ¡bado', sunday: 'Domingo'
            };
            document.getElementById('busiest-day').textContent = dayCount[busiestDay] > 0 ? dayNames[busiestDay] : '-';
            
            // Next class
            updateNextClass();
        }

        function updateNextClass() {
            const now = new Date();
            const currentDay = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'][now.getDay()];
            const currentTime = now.getHours() * 100 + now.getMinutes();
            
            let nextClass = null;
            let minTimeDiff = Infinity;
            
            // Check today first
            if (scheduleData[currentDay]) {
                Object.keys(scheduleData[currentDay]).forEach(time => {
                    const timeNum = parseInt(time.replace(':', ''));
                    if (timeNum > currentTime) {
                        const timeDiff = timeNum - currentTime;
                        if (timeDiff < minTimeDiff) {
                            minTimeDiff = timeDiff;
                            nextClass = time;
                        }
                    }
                });
            }
            
            document.getElementById('next-class').textContent = nextClass || '-';
        }

        function updateTodaySchedule() {
            const now = new Date();
            const currentDay = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'][now.getDay()];
            const dayNames = {
                sunday: 'Domingo', monday: 'Segunda-feira', tuesday: 'TerÃ§a-feira',
                wednesday: 'Quarta-feira', thursday: 'Quinta-feira', friday: 'Sexta-feira', saturday: 'SÃ¡bado'
            };
            
            document.getElementById('current-day-name').textContent = dayNames[currentDay];
            
            const todayContainer = document.getElementById('today-schedule');
            const todayClassesCount = document.getElementById('today-classes-count');
            
            todayContainer.innerHTML = '';
            
            if (scheduleData[currentDay]) {
                const todayClasses = Object.keys(scheduleData[currentDay]).sort();
                todayClassesCount.textContent = todayClasses.length;
                
                todayClasses.forEach(time => {
                    const classData = scheduleData[currentDay][time];
                    const classElement = document.createElement('div');
                    classElement.className = 'bg-white/20 rounded-lg p-3 flex items-center justify-between';
                    classElement.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="text-lg font-bold">${time}</div>
                            <div>
                                <div class="font-medium">${classData.name}</div>
                                <div class="text-sm text-blue-100">${classData.room} â€¢ ${classData.teacher || 'Professor'}</div>
                            </div>
                        </div>
                        <div class="text-2xl">${getSubjectEmoji(classData.subject)}</div>
                    `;
                    todayContainer.appendChild(classElement);
                });
            } else {
                todayClassesCount.textContent = '0';
                todayContainer.innerHTML = '<div class="text-center text-blue-100 py-4">ğŸ‰ Nenhuma aula hoje! Aproveite para estudar ou descansar.</div>';
            }
        }

        function getSubjectEmoji(subject) {
            const emojis = {
                math: 'ğŸ”¢', portuguese: 'ğŸ“', science: 'ğŸ”¬', history: 'ğŸ“š',
                english: 'ğŸ‡ºğŸ‡¸', pe: 'âš½', geography: 'ğŸŒ', arts: 'ğŸ¨',
                music: 'ğŸµ', philosophy: 'ğŸ¤”'
            };
            return emojis[subject] || 'ğŸ“–';
        }

        function addClassToSchedule(day, time) {
            showModal(`
                <h3 class="text-lg font-semibold mb-4">â• Adicionar Aula</h3>
                <form onsubmit="saveClassToSchedule(event, '${day}', '${time}')">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome da MatÃ©ria</label>
                        <input type="text" id="class-name" class="w-full p-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sala/Local</label>
                        <input type="text" id="class-room" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Ex: Sala 101">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Professor(a)</label>
                        <input type="text" id="class-teacher" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Nome do professor">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de MatÃ©ria</label>
                        <select id="class-subject" class="w-full p-2 border border-gray-300 rounded-lg">
                            <option value="math">ğŸ”¢ MatemÃ¡tica</option>
                            <option value="portuguese">ğŸ“ PortuguÃªs</option>
                            <option value="science">ğŸ”¬ CiÃªncias</option>
                            <option value="history">ğŸ“š HistÃ³ria</option>
                            <option value="english">ğŸ‡ºğŸ‡¸ InglÃªs</option>
                            <option value="pe">âš½ EducaÃ§Ã£o FÃ­sica</option>
                            <option value="geography">ğŸŒ Geografia</option>
                            <option value="arts">ğŸ¨ Artes</option>
                            <option value="music">ğŸµ MÃºsica</option>
                            <option value="philosophy">ğŸ¤” Filosofia</option>
                        </select>
                    </div>
                    <div class="flex space-x-2">
                        <button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">Salvar</button>
                        <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">Cancelar</button>
                    </div>
                </form>
            `);
        }

        function saveClassToSchedule(event, day, time) {
            event.preventDefault();
            
            if (!scheduleData[day]) {
                scheduleData[day] = {};
            }
            
            scheduleData[day][time] = {
                name: document.getElementById('class-name').value,
                room: document.getElementById('class-room').value,
                teacher: document.getElementById('class-teacher').value,
                subject: document.getElementById('class-subject').value
            };
            
            updateScheduleDisplay();
            updateScheduleStats();
            updateTodaySchedule();
            closeModal();
            showNotification('âœ… Aula adicionada com sucesso!', 'success');
            saveData();
        }

        function editClass(event, day, time) {
            event.stopPropagation();
            const classData = scheduleData[day][time];
            
            showModal(`
                <h3 class="text-lg font-semibold mb-4">âœï¸ Editar Aula</h3>
                <form onsubmit="saveClassToSchedule(event, '${day}', '${time}')">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome da MatÃ©ria</label>
                        <input type="text" id="class-name" class="w-full p-2 border border-gray-300 rounded-lg" value="${classData.name}" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sala/Local</label>
                        <input type="text" id="class-room" class="w-full p-2 border border-gray-300 rounded-lg" value="${classData.room || ''}" placeholder="Ex: Sala 101">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Professor(a)</label>
                        <input type="text" id="class-teacher" class="w-full p-2 border border-gray-300 rounded-lg" value="${classData.teacher || ''}" placeholder="Nome do professor">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de MatÃ©ria</label>
                        <select id="class-subject" class="w-full p-2 border border-gray-300 rounded-lg">
                            <option value="math" ${classData.subject === 'math' ? 'selected' : ''}>ğŸ”¢ MatemÃ¡tica</option>
                            <option value="portuguese" ${classData.subject === 'portuguese' ? 'selected' : ''}>ğŸ“ PortuguÃªs</option>
                            <option value="science" ${classData.subject === 'science' ? 'selected' : ''}>ğŸ”¬ CiÃªncias</option>
                            <option value="history" ${classData.subject === 'history' ? 'selected' : ''}>ğŸ“š HistÃ³ria</option>
                            <option value="english" ${classData.subject === 'english' ? 'selected' : ''}>ğŸ‡ºğŸ‡¸ InglÃªs</option>
                            <option value="pe" ${classData.subject === 'pe' ? 'selected' : ''}>âš½ EducaÃ§Ã£o FÃ­sica</option>
                            <option value="geography" ${classData.subject === 'geography' ? 'selected' : ''}>ğŸŒ Geografia</option>
                            <option value="arts" ${classData.subject === 'arts' ? 'selected' : ''}>ğŸ¨ Artes</option>
                            <option value="music" ${classData.subject === 'music' ? 'selected' : ''}>ğŸµ MÃºsica</option>
                            <option value="philosophy" ${classData.subject === 'philosophy' ? 'selected' : ''}>ğŸ¤” Filosofia</option>
                        </select>
                    </div>
                    <div class="flex space-x-2">
                        <button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">Salvar</button>
                        <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">Cancelar</button>
                    </div>
                </form>
            `);
        }

        function deleteClass(event, day, time) {
            event.stopPropagation();
            if (confirm('Tem certeza que deseja excluir esta aula?')) {
                delete scheduleData[day][time];
                if (Object.keys(scheduleData[day]).length === 0) {
                    delete scheduleData[day];
                }
                updateScheduleDisplay();
                updateScheduleStats();
                updateTodaySchedule();
                showNotification('ğŸ—‘ï¸ Aula removida com sucesso!', 'success');
                saveData();
            }
        }

        // Task functions
        function addTask() {
            showModal(`
                <h3 class="text-lg font-semibold mb-4">â• Nova Tarefa</h3>
                <form onsubmit="saveTask(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">DescriÃ§Ã£o da Tarefa</label>
                        <input type="text" id="task-description" class="w-full p-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">MatÃ©ria</label>
                        <input type="text" id="task-subject" class="w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Prioridade</label>
                        <select id="task-priority" class="w-full p-2 border border-gray-300 rounded-lg">
                            <option value="urgent">ğŸ”´ Urgente</option>
                            <option value="medium">ğŸŸ¡ MÃ©dio</option>
                            <option value="low">ğŸŸ¢ Tranquilo</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data de Entrega</label>
                        <input type="date" id="task-date" class="w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="flex space-x-2">
                        <button type="submit" class="flex-1 bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">Salvar</button>
                        <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">Cancelar</button>
                    </div>
                </form>
            `);
        }

        function saveTask(event) {
            event.preventDefault();
            const task = {
                id: Date.now(),
                description: document.getElementById('task-description').value,
                subject: document.getElementById('task-subject').value,
                priority: document.getElementById('task-priority').value,
                date: document.getElementById('task-date').value,
                completed: false
            };
            
            tasksData[task.priority].push(task);
            updateTasksDisplay();
            closeModal();
            showNotification('âœ… Tarefa adicionada com sucesso!', 'success');
            saveData();
        }

        function updateTasksDisplay() {
            ['urgent', 'medium', 'low'].forEach(priority => {
                const container = document.getElementById(priority + '-tasks');
                container.innerHTML = '';
                
                tasksData[priority].forEach(task => {
                    const taskElement = document.createElement('div');
                    taskElement.className = `p-3 bg-gray-50 rounded-lg priority-${priority === 'urgent' ? 'high' : priority === 'medium' ? 'medium' : 'low'} ${task.completed ? 'opacity-50' : ''}`;
                    taskElement.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="font-medium ${task.completed ? 'line-through' : ''}">${task.description}</div>
                                <div class="text-sm text-gray-600">${task.subject} ${task.date ? 'â€¢ ' + task.date : ''}</div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="toggleTask(${task.id})" class="text-green-600 hover:text-green-800">
                                    ${task.completed ? 'â†©ï¸' : 'âœ…'}
                                </button>
                                <button onclick="deleteTask(${task.id})" class="text-red-600 hover:text-red-800">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(taskElement);
                });
            });
        }

        function toggleTask(taskId) {
            ['urgent', 'medium', 'low'].forEach(priority => {
                const task = tasksData[priority].find(t => t.id === taskId);
                if (task) {
                    task.completed = !task.completed;
                    if (task.completed) {
                        checkAchievements();
                        showNotification('ğŸ‰ ParabÃ©ns! Tarefa concluÃ­da!', 'success');
                    }
                }
            });
            updateTasksDisplay();
            saveData();
        }

        function deleteTask(taskId) {
            ['urgent', 'medium', 'low'].forEach(priority => {
                tasksData[priority] = tasksData[priority].filter(t => t.id !== taskId);
            });
            updateTasksDisplay();
            saveData();
        }

        // Calendar functions
        function updateCalendar() {
            const monthNames = ['Janeiro', 'Fevereiro', 'MarÃ§o', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            document.getElementById('current-month').textContent = 
                monthNames[currentDate.getMonth()] + ' ' + currentDate.getFullYear();
            
            const calendarGrid = document.getElementById('calendar-grid');
            calendarGrid.innerHTML = '';
            
            // Day headers
            const dayHeaders = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'SÃ¡b'];
            dayHeaders.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center font-semibold text-gray-600 py-2';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            // Calendar days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dayCell = document.createElement('div');
                dayCell.className = 'min-h-20 p-2 border border-gray-200 cursor-pointer hover:bg-blue-50';
                
                if (cellDate.getMonth() !== currentDate.getMonth()) {
                    dayCell.classList.add('text-gray-400');
                }
                
                const dayEvents = eventsData.filter(event => 
                    new Date(event.date).toDateString() === cellDate.toDateString()
                );
                
                dayCell.innerHTML = `
                    <div class="font-medium">${cellDate.getDate()}</div>
                    ${dayEvents.map(event => `<div class="text-xs bg-blue-100 text-blue-800 rounded px-1 mt-1">${event.title}</div>`).join('')}
                `;
                
                dayCell.onclick = () => addEventToDate(cellDate);
                calendarGrid.appendChild(dayCell);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateCalendar();
        }

        function addEvent() {
            showModal(`
                <h3 class="text-lg font-semibold mb-4">â• Novo Evento</h3>
                <form onsubmit="saveEvent(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">TÃ­tulo do Evento</label>
                        <input type="text" id="event-title" class="w-full p-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                        <input type="date" id="event-date" class="w-full p-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                        <select id="event-type" class="w-full p-2 border border-gray-300 rounded-lg">
                            <option value="exam">ğŸ“ Prova</option>
                            <option value="assignment">ğŸ“š Trabalho</option>
                            <option value="event">ğŸ‰ Evento</option>
                            <option value="reminder">â° Lembrete</option>
                        </select>
                    </div>
                    <div class="flex space-x-2">
                        <button type="submit" class="flex-1 bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600">Salvar</button>
                        <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">Cancelar</button>
                    </div>
                </form>
            `);
        }

        function saveEvent(event) {
            event.preventDefault();
            const newEvent = {
                id: Date.now(),
                title: document.getElementById('event-title').value,
                date: document.getElementById('event-date').value,
                type: document.getElementById('event-type').value
            };
            
            eventsData.push(newEvent);
            updateCalendar();
            closeModal();
            showNotification('ğŸ“… Evento adicionado com sucesso!', 'success');
            saveData();
        }

        // Diary functions
        function setMood(mood) {
            currentMood = mood;
            document.querySelectorAll('.mood-emoji').forEach(emoji => {
                emoji.style.transform = 'scale(1)';
            });
            event.target.style.transform = 'scale(1.3)';
        }

        function saveDiaryEntry() {
            const learning = document.getElementById('learning-notes').value;
            const difficulties = document.getElementById('difficulties').value;
            
            if (!learning && !difficulties && !currentMood) {
                showNotification('âš ï¸ Preencha pelo menos um campo!', 'warning');
                return;
            }
            
            const entry = {
                id: Date.now(),
                date: new Date().toLocaleDateString('pt-BR'),
                mood: currentMood,
                learning: learning,
                difficulties: difficulties
            };
            
            diaryEntries.unshift(entry);
            updateDiaryDisplay();
            
            // Clear form
            document.getElementById('learning-notes').value = '';
            document.getElementById('difficulties').value = '';
            currentMood = null;
            document.querySelectorAll('.mood-emoji').forEach(emoji => {
                emoji.style.transform = 'scale(1)';
            });
            
            showNotification('ğŸ“– Entrada do diÃ¡rio salva!', 'success');
            saveData();
        }

        function updateDiaryDisplay() {
            const container = document.getElementById('diary-entries');
            container.innerHTML = '';
            
            diaryEntries.slice(0, 5).forEach(entry => {
                const entryElement = document.createElement('div');
                entryElement.className = 'bg-white p-4 rounded-lg card-shadow';
                
                const moodEmoji = entry.mood === 'happy' ? 'ğŸ˜ƒ' : entry.mood === 'neutral' ? 'ğŸ˜' : entry.mood === 'sad' ? 'ğŸ˜' : '';
                
                entryElement.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <div class="font-medium text-gray-800">${entry.date}</div>
                        <div class="text-2xl">${moodEmoji}</div>
                    </div>
                    ${entry.learning ? `<div class="mb-2"><strong>Aprendizado:</strong> ${entry.learning}</div>` : ''}
                    ${entry.difficulties ? `<div><strong>Dificuldades:</strong> ${entry.difficulties}</div>` : ''}
                `;
                
                container.appendChild(entryElement);
            });
        }

        // Progress functions
        function updateProgressDisplay() {
            updateGradesChart();
            updateAchievementsList();
        }

        function updateGradesChart() {
            const container = document.getElementById('grades-chart');
            container.innerHTML = '';
            
            Object.keys(gradesData).forEach(subject => {
                const grades = gradesData[subject];
                const average = grades.reduce((sum, grade) => sum + grade.value, 0) / grades.length;
                
                const subjectElement = document.createElement('div');
                subjectElement.className = 'mb-4';
                subjectElement.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium">${subject}</span>
                        <span class="text-lg font-bold text-blue-600">${average.toFixed(1)}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-blue-500 h-3 rounded-full" style="width: ${(average / 10) * 100}%"></div>
                    </div>
                `;
                container.appendChild(subjectElement);
            });
        }

        function addGrade() {
            showModal(`
                <h3 class="text-lg font-semibold mb-4">â• Adicionar Nota</h3>
                <form onsubmit="saveGrade(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">MatÃ©ria</label>
                        <input type="text" id="grade-subject" class="w-full p-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nota (0-10)</label>
                        <input type="number" id="grade-value" min="0" max="10" step="0.1" class="w-full p-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de AvaliaÃ§Ã£o</label>
                        <select id="grade-type" class="w-full p-2 border border-gray-300 rounded-lg">
                            <option value="exam">Prova</option>
                            <option value="assignment">Trabalho</option>
                            <option value="participation">ParticipaÃ§Ã£o</option>
                        </select>
                    </div>
                    <div class="flex space-x-2">
                        <button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">Salvar</button>
                        <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">Cancelar</button>
                    </div>
                </form>
            `);
        }

        function saveGrade(event) {
            event.preventDefault();
            const subject = document.getElementById('grade-subject').value;
            const value = parseFloat(document.getElementById('grade-value').value);
            const type = document.getElementById('grade-type').value;
            
            if (!gradesData[subject]) {
                gradesData[subject] = [];
            }
            
            gradesData[subject].push({
                value: value,
                type: type,
                date: new Date().toLocaleDateString('pt-BR')
            });
            
            updateProgressDisplay();
            closeModal();
            showNotification('ğŸ“Š Nota adicionada com sucesso!', 'success');
            checkAchievements();
            saveData();
        }

        // Achievement system
        function checkAchievements() {
            const completedTasks = Object.values(tasksData).flat().filter(task => task.completed).length;
            const totalGrades = Object.values(gradesData).flat().length;
            
            // Task completion achievements
            if (completedTasks >= 5 && !achievements.find(a => a.id === 'tasks_5')) {
                addAchievement('tasks_5', 'ğŸ¯ Organizador', 'Completou 5 tarefas!');
            }
            
            if (completedTasks >= 20 && !achievements.find(a => a.id === 'tasks_20')) {
                addAchievement('tasks_20', 'â­ Super Organizador', 'Completou 20 tarefas!');
            }
            
            // Grade achievements
            if (totalGrades >= 5 && !achievements.find(a => a.id === 'grades_5')) {
                addAchievement('grades_5', 'ğŸ“š Estudioso', 'Registrou 5 notas!');
            }
            
            // Diary achievements
            if (diaryEntries.length >= 7 && !achievements.find(a => a.id === 'diary_7')) {
                addAchievement('diary_7', 'ğŸ“– Reflexivo', 'Escreveu no diÃ¡rio por 7 dias!');
            }
        }

        function addAchievement(id, title, description) {
            achievements.push({ id, title, description, date: new Date().toLocaleDateString('pt-BR') });
            updateAchievementsList();
            showNotification(`ğŸ† Nova conquista: ${title}!`, 'success');
            saveData();
        }

        function updateAchievementsList() {
            const container = document.getElementById('achievements-list');
            container.innerHTML = '';
            
            if (achievements.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-4">Nenhuma conquista ainda. Continue estudando!</div>';
                return;
            }
            
            achievements.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = 'flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg achievement-badge';
                achievementElement.innerHTML = `
                    <div class="text-2xl">ğŸ†</div>
                    <div class="flex-1">
                        <div class="font-semibold text-yellow-800">${achievement.title}</div>
                        <div class="text-sm text-yellow-600">${achievement.description}</div>
                        <div class="text-xs text-yellow-500">${achievement.date}</div>
                    </div>
                `;
                container.appendChild(achievementElement);
            });
        }

        function showAchievements() {
            let achievementsList = achievements.map(a => `
                <div class="flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg mb-2">
                    <div class="text-2xl">ğŸ†</div>
                    <div>
                        <div class="font-semibold text-yellow-800">${a.title}</div>
                        <div class="text-sm text-yellow-600">${a.description}</div>
                    </div>
                </div>
            `).join('');
            
            if (achievements.length === 0) {
                achievementsList = '<div class="text-gray-500 text-center py-4">Nenhuma conquista ainda. Continue estudando!</div>';
            }
            
            showModal(`
                <h3 class="text-lg font-semibold mb-4">ğŸ† Suas Conquistas</h3>
                <div class="max-h-96 overflow-y-auto">
                    ${achievementsList}
                </div>
                <button onclick="closeModal()" class="w-full mt-4 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">Fechar</button>
            `);
        }

        // Chat functions
        function initializeChat() {
            // Add some sample messages
            if (chatMessages.length === 0) {
                addSampleMessages();
            }
            updateChatDisplay();
            updateSharedContentDisplay();
        }

        function addSampleMessages() {
            const sampleMessages = [
                { user: 'Ana Silva', message: 'Oi pessoal! Acabei de terminar minha sessÃ£o de estudo ğŸ“š', time: '14:30', type: 'message' },
                { user: 'Bruno Costa', message: 'Que legal Ana! Eu tambÃ©m estou usando o planner, muito Ãºtil! ğŸ’ª', time: '14:32', type: 'message' },
                { user: 'Carla Lima', message: 'AlguÃ©m pode me ajudar com matemÃ¡tica? Estou com dificuldade em equaÃ§Ãµes ğŸ˜…', time: '14:35', type: 'message' },
                { user: 'Diego Santos', message: 'Claro Carla! Posso te explicar depois da aula ğŸ“š', time: '14:36', type: 'message' },
                { user: 'Ana Silva', message: 'â¤ï¸', time: '14:37', type: 'emoji' }
            ];
            
            chatMessages = sampleMessages;
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message) {
                const newMessage = {
                    user: currentUser,
                    message: message,
                    time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                    type: 'message'
                };
                
                // Save to Firebase
                saveChatMessage(newMessage);
                input.value = '';
                
                // Simulate responses from other users occasionally
                if (Math.random() < 0.3) {
                    setTimeout(simulateResponse, 1000 + Math.random() * 3000);
                }
            }
        }

        function sendEmoji(emoji) {
            const newMessage = {
                user: currentUser,
                message: emoji,
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                type: 'emoji'
            };
            
            // Save to Firebase
            saveChatMessage(newMessage);
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function updateChatDisplay() {
            const container = document.getElementById('chat-messages');
            container.innerHTML = '';
            
            chatMessages.slice(-20).forEach(msg => {
                const messageElement = document.createElement('div');
                const isCurrentUser = msg.user === currentUser;
                
                messageElement.className = `flex ${isCurrentUser ? 'justify-end' : 'justify-start'}`;
                
                if (msg.type === 'emoji') {
                    messageElement.innerHTML = `
                        <div class="flex items-center space-x-2 ${isCurrentUser ? 'flex-row-reverse space-x-reverse' : ''}">
                            <div class="w-8 h-8 ${getUserColor(msg.user)} rounded-full flex items-center justify-center text-white text-sm font-bold">
                                ${msg.user.charAt(0).toUpperCase()}
                            </div>
                            <div class="text-2xl">${msg.message}</div>
                            <div class="text-xs text-gray-500">${msg.time}</div>
                        </div>
                    `;
                } else {
                    messageElement.innerHTML = `
                        <div class="flex items-start space-x-2 max-w-xs ${isCurrentUser ? 'flex-row-reverse space-x-reverse' : ''}">
                            <div class="w-8 h-8 ${getUserColor(msg.user)} rounded-full flex items-center justify-center text-white text-sm font-bold">
                                ${msg.user.charAt(0).toUpperCase()}
                            </div>
                            <div class="${isCurrentUser ? 'bg-blue-500 text-white' : 'bg-gray-100'} rounded-lg p-3">
                                <div class="font-medium text-sm ${isCurrentUser ? 'text-blue-100' : 'text-gray-600'}">${msg.user}</div>
                                <div class="text-sm">${msg.message}</div>
                                <div class="text-xs ${isCurrentUser ? 'text-blue-200' : 'text-gray-500'} mt-1">${msg.time}</div>
                            </div>
                        </div>
                    `;
                }
                
                container.appendChild(messageElement);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        function getUserColor(username) {
            const colors = ['bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-orange-500', 'bg-pink-500', 'bg-indigo-500'];
            const index = username.length % colors.length;
            return colors[index];
        }

        function simulateResponse() {
            const responses = [
                { user: 'Ana Silva', message: 'Boa! Continue assim! ğŸ‘' },
                { user: 'Bruno Costa', message: 'AlguÃ©m quer formar um grupo de estudos? ğŸ“š' },
                { user: 'Carla Lima', message: 'Acabei de completar 3 tarefas hoje! ğŸ‰' },
                { user: 'Diego Santos', message: 'Vamos que vamos! Foco nos estudos! ğŸ’ª' }
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            const newMessage = {
                user: randomResponse.user,
                message: randomResponse.message,
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                type: 'message'
            };
            
            chatMessages.push(newMessage);
            updateChatDisplay();
        }

        function shareProgress() {
            if (Object.keys(gradesData).length === 0) {
                showNotification('âš ï¸ Adicione algumas notas primeiro!', 'warning');
                return;
            }
            
            const totalGrades = Object.values(gradesData).flat().length;
            const completedTasks = Object.values(tasksData).flat().filter(task => task.completed).length;
            
            const progressShare = {
                id: Date.now(),
                user: currentUser,
                type: 'progress',
                title: 'ğŸ“Š Meu Progresso Escolar',
                content: {
                    grades: totalGrades,
                    tasks: completedTasks,
                    achievements: achievements.length
                },
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                date: new Date().toLocaleDateString('pt-BR')
            };
            
            // Save to Firebase
            saveSharedContent(progressShare);
            
            // Also send a chat message
            const chatMessage = {
                user: currentUser,
                message: `Compartilhei meu progresso! ğŸ“Š ${totalGrades} notas, ${completedTasks} tarefas concluÃ­das!`,
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                type: 'message'
            };
            
            saveChatMessage(chatMessage);
            showNotification('ğŸ“Š Progresso compartilhado com sucesso!', 'success');
        }

        function shareDiary() {
            if (diaryEntries.length === 0) {
                showNotification('âš ï¸ Escreva no seu diÃ¡rio primeiro!', 'warning');
                return;
            }
            
            const latestEntry = diaryEntries[0];
            const moodEmoji = latestEntry.mood === 'happy' ? 'ğŸ˜ƒ' : latestEntry.mood === 'neutral' ? 'ğŸ˜' : latestEntry.mood === 'sad' ? 'ğŸ˜' : 'ğŸ˜Š';
            
            const diaryShare = {
                id: Date.now(),
                user: currentUser,
                type: 'diary',
                title: 'ğŸ“– Meu DiÃ¡rio de Hoje',
                content: {
                    mood: moodEmoji,
                    learning: latestEntry.learning,
                    difficulties: latestEntry.difficulties,
                    date: latestEntry.date
                },
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                date: new Date().toLocaleDateString('pt-BR')
            };
            
            // Save to Firebase
            saveSharedContent(diaryShare);
            
            // Also send a chat message
            const chatMessage = {
                user: currentUser,
                message: `Compartilhei meu diÃ¡rio de hoje! ${moodEmoji} Venham ver como foi meu dia de estudos!`,
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                type: 'message'
            };
            
            saveChatMessage(chatMessage);
            showNotification('ğŸ“– DiÃ¡rio compartilhado com sucesso!', 'success');
        }

        function updateSharedContentDisplay() {
            const container = document.getElementById('shared-content');
            container.innerHTML = '';
            
            if (sharedContent.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">Nenhum compartilhamento ainda. Seja o primeiro a compartilhar!</div>';
                return;
            }
            
            sharedContent.slice(0, 6).forEach(share => {
                const shareElement = document.createElement('div');
                shareElement.className = 'bg-white rounded-lg p-4 card-shadow hover:shadow-lg transition-shadow';
                
                if (share.type === 'progress') {
                    shareElement.innerHTML = `
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 ${getUserColor(share.user)} rounded-full flex items-center justify-center text-white text-sm font-bold">
                                    ${share.user.charAt(0).toUpperCase()}
                                </div>
                                <div class="font-medium text-sm">${share.user}</div>
                            </div>
                            <div class="text-xs text-gray-500">${share.time}</div>
                        </div>
                        <h4 class="font-semibold text-gray-800 mb-2">${share.title}</h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-blue-50 p-2 rounded">
                                <div class="font-medium text-blue-800">ğŸ“ Notas</div>
                                <div class="text-blue-600">${share.content.grades}</div>
                            </div>
                            <div class="bg-green-50 p-2 rounded">
                                <div class="font-medium text-green-800">âœ… Tarefas</div>
                                <div class="text-green-600">${share.content.tasks}</div>
                            </div>
                            <div class="bg-yellow-50 p-2 rounded col-span-2">
                                <div class="font-medium text-yellow-800">ğŸ† Conquistas</div>
                                <div class="text-yellow-600">${share.content.achievements}</div>
                            </div>
                        </div>
                        <div class="mt-3 flex space-x-2">
                            <button onclick="likeShare(${share.id})" class="text-sm text-blue-600 hover:text-blue-800">ğŸ‘ Curtir</button>
                            <button onclick="commentShare(${share.id})" class="text-sm text-gray-600 hover:text-gray-800">ğŸ’¬ Comentar</button>
                        </div>
                    `;
                } else if (share.type === 'diary') {
                    shareElement.innerHTML = `
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 ${getUserColor(share.user)} rounded-full flex items-center justify-center text-white text-sm font-bold">
                                    ${share.user.charAt(0).toUpperCase()}
                                </div>
                                <div class="font-medium text-sm">${share.user}</div>
                            </div>
                            <div class="text-xs text-gray-500">${share.time}</div>
                        </div>
                        <h4 class="font-semibold text-gray-800 mb-2">${share.title}</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl">${share.content.mood}</span>
                                <span class="text-gray-600">Como me senti hoje</span>
                            </div>
                            ${share.content.learning ? `<div class="bg-blue-50 p-2 rounded"><strong>Aprendi:</strong> ${share.content.learning.substring(0, 100)}${share.content.learning.length > 100 ? '...' : ''}</div>` : ''}
                            ${share.content.difficulties ? `<div class="bg-orange-50 p-2 rounded"><strong>Dificuldades:</strong> ${share.content.difficulties.substring(0, 100)}${share.content.difficulties.length > 100 ? '...' : ''}</div>` : ''}
                        </div>
                        <div class="mt-3 flex space-x-2">
                            <button onclick="likeShare(${share.id})" class="text-sm text-blue-600 hover:text-blue-800">ğŸ‘ Curtir</button>
                            <button onclick="commentShare(${share.id})" class="text-sm text-gray-600 hover:text-gray-800">ğŸ’¬ Comentar</button>
                        </div>
                    `;
                }
                
                container.appendChild(shareElement);
            });
        }

        function likeShare(shareId) {
            const chatMessage = {
                user: currentUser,
                message: 'ğŸ‘',
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                type: 'emoji'
            };
            
            chatMessages.push(chatMessage);
            updateChatDisplay();
            showNotification('ğŸ‘ Curtida enviada!', 'success');
        }

        function commentShare(shareId) {
            const comment = prompt('Digite seu comentÃ¡rio:');
            if (comment && comment.trim()) {
                const chatMessage = {
                    user: currentUser,
                    message: `ğŸ’¬ ${comment.trim()}`,
                    time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                    type: 'message'
                };
                
                chatMessages.push(chatMessage);
                updateChatDisplay();
                showNotification('ğŸ’¬ ComentÃ¡rio enviado!', 'success');
            }
        }

        // Utility functions
        function showModal(content) {
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('modal-overlay').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification p-4 rounded-lg text-white max-w-sm ${
                type === 'success' ? 'bg-green-500' : 
                type === 'warning' ? 'bg-yellow-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.getElementById('notifications').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showMotivationalMessage() {
            const messages = [
                'VocÃª consegue! Vamos focar nos estudos! ğŸ’ª',
                'Continue firme! Cada minuto conta! â­',
                'VocÃª estÃ¡ indo muito bem! ğŸŒŸ',
                'Foco e determinaÃ§Ã£o! VocÃª Ã© capaz! ğŸš€',
                'Mais uma sessÃ£o, mais conhecimento! ğŸ“š'
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            // This would be used if we had a motivation message element
        }

        // Firebase data persistence
        let currentUserId = null;
        let isFirebaseReady = false;

        // Initialize Firebase data when auth is ready
        window.initFirebaseData = function() {
            isFirebaseReady = true;
            window.firebaseFunctions.onAuthStateChanged(window.firebaseAuth, (user) => {
                if (user) {
                    currentUserId = user.uid;
                    loadDataFromFirebase();
                    setupRealtimeListeners();
                    updateFirebaseStatus('connected');
                    showNotification('ğŸ”¥ Conectado ao Firebase!', 'success');
                }
            });
        };

        // Update Firebase connection status
        function updateFirebaseStatus(status) {
            const statusElement = document.getElementById('firebase-status');
            if (!statusElement) return;

            switch(status) {
                case 'connecting':
                    statusElement.innerHTML = 'ğŸ”„ Conectando...';
                    statusElement.className = 'text-xs bg-yellow-500/20 text-yellow-200 px-2 py-1 rounded-full';
                    break;
                case 'connected':
                    statusElement.innerHTML = 'ğŸ”¥ Online';
                    statusElement.className = 'text-xs bg-green-500/20 text-green-200 px-2 py-1 rounded-full';
                    break;
                case 'error':
                    statusElement.innerHTML = 'âš ï¸ Offline';
                    statusElement.className = 'text-xs bg-red-500/20 text-red-200 px-2 py-1 rounded-full';
                    break;
            }
        }

        // Save data to Firebase
        async function saveData() {
            // Also save to localStorage as backup
            const data = {
                scheduleData,
                tasksData,
                eventsData,
                diaryEntries,
                gradesData,
                achievements,
                chatMessages,
                sharedContent
            };
            localStorage.setItem('estudoFacilData', JSON.stringify(data));

            if (!isFirebaseReady || !currentUserId) return;

            try {
                // Save user data to Firebase
                const userDataRef = window.firebaseFunctions.doc(window.firebaseDb, 'users', currentUserId);
                await window.firebaseFunctions.updateDoc(userDataRef, {
                    scheduleData,
                    tasksData,
                    eventsData,
                    diaryEntries,
                    gradesData,
                    achievements,
                    lastUpdated: new Date().toISOString()
                }).catch(async (error) => {
                    if (error.code === 'not-found') {
                        await window.firebaseFunctions.addDoc(window.firebaseFunctions.collection(window.firebaseDb, 'users'), {
                            userId: currentUserId,
                            scheduleData,
                            tasksData,
                            eventsData,
                            diaryEntries,
                            gradesData,
                            achievements,
                            lastUpdated: new Date().toISOString()
                        });
                    }
                });
            } catch (error) {
                console.error('Erro ao salvar no Firebase:', error);
            }
        }

        // Load data from Firebase
        async function loadDataFromFirebase() {
            try {
                const userQuery = window.firebaseFunctions.query(
                    window.firebaseFunctions.collection(window.firebaseDb, 'users'),
                    window.firebaseFunctions.limit(1)
                );
                const querySnapshot = await window.firebaseFunctions.getDocs(userQuery);
                
                if (!querySnapshot.empty) {
                    const userData = querySnapshot.docs[0].data();
                    scheduleData = userData.scheduleData || {};
                    tasksData = userData.tasksData || { urgent: [], medium: [], low: [] };
                    eventsData = userData.eventsData || [];
                    diaryEntries = userData.diaryEntries || [];
                    gradesData = userData.gradesData || {};
                    achievements = userData.achievements || [];
                    
                    // Update displays
                    updateScheduleDisplay();
                    updateScheduleStats();
                    updateTodaySchedule();
                    updateTasksDisplay();
                    updateCalendar();
                    updateDiaryDisplay();
                    updateProgressDisplay();
                    
                    console.log('ğŸ“Š Dados carregados do Firebase!');
                } else {
                    // Load from localStorage if no Firebase data
                    loadData();
                }
                
                // Load chat messages
                loadChatMessages();
                loadSharedContent();
                
            } catch (error) {
                console.error('Erro ao carregar do Firebase:', error);
                // Fallback to localStorage
                loadData();
            }
        }

        // Load data from localStorage (fallback)
        function loadData() {
            const savedData = localStorage.getItem('estudoFacilData');
            if (savedData) {
                const data = JSON.parse(savedData);
                scheduleData = data.scheduleData || {};
                tasksData = data.tasksData || { urgent: [], medium: [], low: [] };
                eventsData = data.eventsData || [];
                diaryEntries = data.diaryEntries || [];
                gradesData = data.gradesData || {};
                achievements = data.achievements || [];
                chatMessages = data.chatMessages || [];
                sharedContent = data.sharedContent || [];
                
                updateDiaryDisplay();
            }
        }

        // Save chat message to Firebase
        async function saveChatMessage(message) {
            if (!isFirebaseReady) return;

            try {
                await window.firebaseFunctions.addDoc(window.firebaseFunctions.collection(window.firebaseDb, 'chatMessages'), {
                    ...message,
                    timestamp: new Date().toISOString()
                });
            } catch (error) {
                console.error('Erro ao salvar mensagem:', error);
            }
        }

        // Load chat messages from Firebase
        async function loadChatMessages() {
            if (!isFirebaseReady) return;

            try {
                const messagesQuery = window.firebaseFunctions.query(
                    window.firebaseFunctions.collection(window.firebaseDb, 'chatMessages'),
                    window.firebaseFunctions.orderBy('timestamp', 'desc'),
                    window.firebaseFunctions.limit(50)
                );
                
                const querySnapshot = await window.firebaseFunctions.getDocs(messagesQuery);
                chatMessages = [];
                
                querySnapshot.forEach((doc) => {
                    chatMessages.unshift(doc.data());
                });
                
                updateChatDisplay();
            } catch (error) {
                console.error('Erro ao carregar mensagens:', error);
            }
        }

        // Save shared content to Firebase
        async function saveSharedContent(content) {
            if (!isFirebaseReady) return;

            try {
                await window.firebaseFunctions.addDoc(window.firebaseFunctions.collection(window.firebaseDb, 'sharedContent'), {
                    ...content,
                    timestamp: new Date().toISOString()
                });
            } catch (error) {
                console.error('Erro ao salvar conteÃºdo compartilhado:', error);
            }
        }

        // Load shared content from Firebase
        async function loadSharedContent() {
            if (!isFirebaseReady) return;

            try {
                const contentQuery = window.firebaseFunctions.query(
                    window.firebaseFunctions.collection(window.firebaseDb, 'sharedContent'),
                    window.firebaseFunctions.orderBy('timestamp', 'desc'),
                    window.firebaseFunctions.limit(20)
                );
                
                const querySnapshot = await window.firebaseFunctions.getDocs(contentQuery);
                sharedContent = [];
                
                querySnapshot.forEach((doc) => {
                    sharedContent.push(doc.data());
                });
                
                updateSharedContentDisplay();
            } catch (error) {
                console.error('Erro ao carregar conteÃºdo compartilhado:', error);
            }
        }

        // Setup realtime listeners for chat and shared content
        function setupRealtimeListeners() {
            if (!isFirebaseReady) return;

            // Listen for new chat messages
            const messagesQuery = window.firebaseFunctions.query(
                window.firebaseFunctions.collection(window.firebaseDb, 'chatMessages'),
                window.firebaseFunctions.orderBy('timestamp', 'desc'),
                window.firebaseFunctions.limit(50)
            );

            window.firebaseFunctions.onSnapshot(messagesQuery, (snapshot) => {
                chatMessages = [];
                snapshot.forEach((doc) => {
                    chatMessages.unshift(doc.data());
                });
                updateChatDisplay();
            });

            // Listen for new shared content
            const contentQuery = window.firebaseFunctions.query(
                window.firebaseFunctions.collection(window.firebaseDb, 'sharedContent'),
                window.firebaseFunctions.orderBy('timestamp', 'desc'),
                window.firebaseFunctions.limit(20)
            );

            window.firebaseFunctions.onSnapshot(contentQuery, (snapshot) => {
                sharedContent = [];
                snapshot.forEach((doc) => {
                    sharedContent.push(doc.data());
                });
                updateSharedContentDisplay();
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96582648506ee83a',t:'MTc1MzU3NzQ5OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
